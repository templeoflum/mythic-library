<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Mythic System Explorer</title>
  <link rel="stylesheet" href="css/styles.css">
  <link rel="stylesheet" href="css/tabs.css">
  <link rel="stylesheet" href="css/view-atlas.css">
  <link rel="stylesheet" href="css/view-codex.css">
  <link rel="stylesheet" href="css/view-chronicle.css">
</head>
<body>
  <div class="app">
    <!-- Header -->
    <header class="header">
      <h1 class="logo">Mythic System Explorer</h1>
      <div class="global-search-wrap">
        <input type="text" id="global-search" class="global-search-input" placeholder="Search nodes, archetypes, entities, patterns...">
        <div id="search-dropdown" class="search-dropdown" hidden></div>
      </div>
      <div class="header-actions">
        <div class="gear-menu-wrap">
          <button id="btn-gear" class="btn btn-secondary btn-icon-gear" title="Settings">&middot;&middot;&middot;</button>
          <div id="gear-dropdown" class="gear-dropdown" hidden>
            <button id="btn-toggle-orientation" class="gear-item">
              <span id="orientation-label">Orientation: Inverted</span>
            </button>
            <div class="gear-divider"></div>
            <button id="btn-export" class="gear-item">Export Traversals</button>
            <label class="gear-item">
              Import Traversals
              <input type="file" id="file-import" accept=".json" hidden>
            </label>
          </div>
        </div>
      </div>
    </header>

    <!-- Navigation -->
    <nav class="tab-nav">
      <button class="tab-btn" data-view="atlas">Atlas</button>
      <button class="tab-btn" data-view="codex">Codex</button>
      <button class="tab-btn" data-view="chronicle">Chronicle</button>
    </nav>

    <!-- View Container -->
    <main class="tab-container">

      <!-- Atlas View -->
      <div id="view-atlas" class="view-content" hidden>
        <div class="atlas-layout-three">

          <!-- Left Panel: Node Info -->
          <aside class="atlas-node-panel" id="atlas-node-panel">
            <div class="panel-header">
              <h3 class="panel-title">Node</h3>
            </div>
            <div class="panel-body" id="node-panel-body">
              <div class="node-panel-empty">
                <p>Click a node to see its details</p>
              </div>
            </div>
          </aside>

          <!-- Middle: Canvas -->
          <div class="atlas-canvas-area">
            <svg id="canvas" class="canvas"></svg>
            <div class="atlas-legend">
              <div class="legend-item">
                <span class="legend-color" style="background: var(--color-descent)"></span>
                <span>Descent</span>
              </div>
              <div class="legend-item">
                <span class="legend-color" style="background: var(--color-resonance)"></span>
                <span>Resonance</span>
              </div>
              <div class="legend-item">
                <span class="legend-color" style="background: var(--color-emergence)"></span>
                <span>Emergence</span>
              </div>
              <div class="legend-item">
                <span class="legend-color" style="background: var(--color-nontion)"></span>
                <span>Nontion</span>
              </div>
            </div>
          </div>

          <!-- Right Panel: Traversals -->
          <aside class="atlas-traversal-panel" id="atlas-traversal-panel">
            <div class="panel-header">
              <h3 class="panel-title">Traversals</h3>
            </div>
            <div class="panel-body">
              <!-- Current Path -->
              <section class="traversal-section">
                <h4 class="section-label">Current Path</h4>
                <div id="current-sequence" class="path-sequence">
                  <span class="hint">Click nodes to build a path...</span>
                </div>
                <div class="traversal-actions">
                  <button id="btn-undo" class="btn btn-small" disabled>Undo</button>
                  <button id="btn-clear" class="btn btn-small" disabled>Clear</button>
                  <button id="btn-save" class="btn btn-primary btn-small" disabled>Save</button>
                </div>
              </section>

              <!-- Groups -->
              <section class="traversal-section">
                <div class="section-header">
                  <h4 class="section-label">Groups</h4>
                  <button id="btn-add-group" class="btn-icon-small" title="Add Group">+</button>
                </div>
                <div id="groups-list" class="groups-list">
                  <!-- Groups rendered here -->
                </div>
              </section>

              <!-- Ungrouped Paths -->
              <section class="traversal-section">
                <div class="section-header">
                  <h4 class="section-label">Ungrouped</h4>
                  <span id="stat-paths" class="stat-badge">0</span>
                </div>
                <div id="paths-list" class="paths-list">
                  <p class="hint">No traversals saved yet.</p>
                </div>
              </section>
            </div>
          </aside>

        </div>
      </div>

      <!-- Codex View -->
      <div id="view-codex" class="view-content" hidden>
        <!-- Populated dynamically by view-codex.js -->
      </div>

      <!-- Chronicle View -->
      <div id="view-chronicle" class="view-content" hidden>
        <!-- Populated dynamically by view-chronicle.js -->
      </div>

    </main>

  </div>

  <!-- Traversal Save Modal -->
  <div id="modal-save-path" class="modal" hidden>
    <div class="modal-content">
      <h2 id="modal-title">Save Traversal</h2>
      <form id="form-save-path">
        <input type="hidden" id="edit-path-id" value="">
        <div class="form-group">
          <label for="path-name">Name *</label>
          <input type="text" id="path-name" required placeholder="e.g., Hero's Journey">
        </div>
        <div class="form-group">
          <label for="path-color">Color</label>
          <div class="color-picker">
            <input type="color" id="path-color" value="#fbbf24">
            <div class="color-presets" id="color-presets"></div>
          </div>
        </div>
        <div class="form-group">
          <label for="path-group">Group</label>
          <select id="path-group">
            <option value="">None (Ungrouped)</option>
          </select>
        </div>
        <div class="form-group">
          <label for="path-description">Description</label>
          <textarea id="path-description" rows="2" placeholder="Optional..."></textarea>
        </div>
        <div class="form-actions">
          <button type="button" class="btn btn-secondary" id="btn-cancel-save">Cancel</button>
          <button type="submit" class="btn btn-primary">Save</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Group Create/Edit Modal -->
  <div id="modal-group" class="modal" hidden>
    <div class="modal-content modal-small">
      <h2 id="modal-group-title">New Group</h2>
      <form id="form-group">
        <input type="hidden" id="edit-group-id" value="">
        <div class="form-group">
          <label for="group-name">Name *</label>
          <input type="text" id="group-name" required placeholder="e.g., Spiral Paths">
        </div>
        <div class="form-actions">
          <button type="button" class="btn btn-secondary" id="btn-cancel-group">Cancel</button>
          <button type="submit" class="btn btn-primary">Save</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Scripts: Infrastructure -->
  <script src="js/nodes.js"></script>
  <script src="js/storage.js"></script>
  <script src="js/data-loader.js"></script>
  <script src="js/nav.js"></script>
  <script src="js/tab-router.js"></script>
  <script src="js/global-search.js"></script>

  <!-- Scripts: Canvas & Rendering -->
  <script src="js/canvas.js"></script>
  <script src="js/card-renderer.js"></script>

  <!-- Scripts: Features -->
  <script src="js/enrichment.js"></script>
  <script src="js/paths.js"></script>

  <!-- Scripts: Views -->
  <script src="js/node-drawer.js"></script>
  <script src="js/detail-sheet.js"></script>
  <script src="js/view-atlas.js"></script>
  <script src="js/view-codex.js"></script>
  <script src="js/mini-map.js"></script>
  <script src="js/view-chronicle.js"></script>

  <!-- Scripts: App Init -->
  <script src="js/app.js"></script>
</body>
</html>
